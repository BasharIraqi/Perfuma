<h1 class="text-primary fw-bold fst-italic p-3">Employees</h1>

<button class="btn btn-info" (click)="onAddClick()">Add New Employee</button>
&nbsp;
<button class="btn btn-success" (click)="onShowClick()">Show Employees</button>

<div class="form-control p-3" [hidden]="addEmployee">

  <h4 class="text-info fw-bold p-2">Add New Employee</h4>

  <alert [hidden]="hide" type="danger" class="m-4">
    <strong class="text-danger fw-bolder">{{errorMessage}}</strong>
  </alert>

  <form #newEmployee="ngForm" (ngSubmit)="onSubmit(newEmployee)">

    <h6>personal details</h6>

    <input type="text" placeholder="id" name="id" required pattern="[0-9]{9}" maxlength="9" ngModel #id="ngModel">
    <app-check-icon *ngIf="id.valid"></app-check-icon>
    <p></p>
    <input type="text" placeholder="first name" name="firstName" required maxlength="30"
      [(ngModel)]="employee.firstName" ngModel #firstName="ngModel">
    <app-check-icon *ngIf="firstName.valid"></app-check-icon>
    <p></p>
    <input type="text" placeholder="last name" name="lastName" required maxlength="30" [(ngModel)]="employee.lastName"
      ngModel #lastName="ngModel">
    <app-check-icon *ngIf="lastName.valid"></app-check-icon>
    <p></p>
    <input type="email" placeholder="email" name="email" required maxlength="30" [(ngModel)]="employee.email" ngModel
      #email="ngModel">
    <app-check-icon *ngIf="email.valid"></app-check-icon>
    <p></p>
    <input type="tel" placeholder="phone" name="phone" required maxlength="10" [(ngModel)]="employee.phoneNumber"
      ngModel #phone="ngModel">
    <app-check-icon *ngIf="phone.valid"></app-check-icon>
    <p></p>
    <input type="text" placeholder="birthDay" name="birthDay" required maxlength="2" [(ngModel)]="employee.birthDay"
      ngModel #birthDay="ngModel">
    <app-check-icon *ngIf="birthDay.valid"></app-check-icon>
    <p></p>
    <input type="text" placeholder="birthMonth" name="birthMonth" required maxlength="2"
      [(ngModel)]="employee.birthMonth" ngModel #birthMonth="ngModel">
    <app-check-icon *ngIf="birthMonth.valid"></app-check-icon>
    <p></p>
    <input type="text" placeholder="birthYear" name="birthYear" required maxlength="4" [(ngModel)]="employee.birthYear"
      ngModel #birthYear="ngModel">
    <app-check-icon *ngIf="birthYear.valid"></app-check-icon>
    <p></p>

    <input type="number" placeholder="salary per hour" name="salary" required [(ngModel)]="employee.salaryPerHour"
      ngModel #salary="ngModel">
    <app-check-icon *ngIf="salary.valid"></app-check-icon>
    <p></p>

    <input type="text" placeholder="started day" name="startedDay" required [(ngModel)]="employee.startedDay" ngModel
      #startedDay="ngModel">
    <app-check-icon *ngIf="startedDay.valid"></app-check-icon>
    <p></p>

    <input type="text" placeholder="started month" name="startedMonth" required [(ngModel)]="employee.startedMonth"
      ngModel #startedMonth="ngModel">
    <app-check-icon *ngIf="startedMonth.valid"></app-check-icon>
    <p></p>

    <input type="text" placeholder="started year" name="startedYear" required [(ngModel)]="employee.startedYear" ngModel
      #startedYear="ngModel">
    <app-check-icon *ngIf="startedYear.valid"></app-check-icon>
    <p></p>

    <label for="jobType">job Type</label>
    &nbsp;
    <select name="jobType" ngModel required #jobType="ngModel">
      <option value="-1"></option>
      <option value="0">Director</option>
      <option value="1">Manager</option>
      <option value="2">General</option>
    </select>
    <app-check-icon *ngIf="jobType.valid"></app-check-icon>
    <p></p>
    <hr>
    <h6>bank account details</h6>
    <input type="number" placeholder="number" name="number" pattern="[0-9]{6}" required
      [(ngModel)]="bankAccount.accountNumber" ngModel #number="ngModel">
    <app-check-icon *ngIf="number.valid"></app-check-icon>
    <p></p>
    <input type="number" placeholder="owner id" name="ownerId" pattern="[0-9]{9}" required
      [(ngModel)]="bankAccount.ownerId" ngModel #ownerId="ngModel">
    <app-check-icon *ngIf="ownerId.valid"></app-check-icon>
    <p></p>
    <input type="text" placeholder="first name" name="ownerFirstName" required maxlength="30"
      [(ngModel)]="bankAccount.firstName" ngModel #ownerFirstName="ngModel">
    <app-check-icon *ngIf="ownerFirstName.valid"></app-check-icon>
    <p></p>
    <input type="text" placeholder="last name" name="ownerLastName" required maxlength="30"
      [(ngModel)]="bankAccount.lastName" ngModel #ownerLastName="ngModel">
    <app-check-icon *ngIf="ownerLastName.valid"></app-check-icon>
    <p></p>

    <label for="bankName">Bank Company</label>
    &nbsp;
    <select name="bankName" ngModel required #bankName="ngModel">
      <option value="-1"></option>
      <option value="0">Leumi</option>
      <option value="1">Boalim</option>
      <option value="2">Discont</option>
      <option value="3">Masad</option>
      <option value="4">Mezrahi</option>
      <option value="5">Yahav</option>
    </select>
    <app-check-icon *ngIf="bankName.valid"></app-check-icon>

    <p></p>
    <input type="number" placeholder="barnch Number" name="branchNumber" pattern="[1-9]{1,3}" required
      [(ngModel)]="bankAccount.branchNumber" ngModel #branchNumber="ngModel">
    <app-check-icon *ngIf="branchNumber.valid"></app-check-icon>

    <p></p>
    <hr>
    <h6>user details</h6>
    <input type="email" placeholder="email" name="userEmail" required maxlength="30" [(ngModel)]="user.email" ngModel
      #userEmail="ngModel">
    <app-check-icon *ngIf="userEmail.valid"></app-check-icon>
    <p></p>
    <input type="password" placeholder="password" name="password" required minlength="8" maxlength="16"
      [(ngModel)]="user.password" ngModel #password="ngModel">
    <app-check-icon *ngIf="password.valid"></app-check-icon>
    <p></p>
    <input type="password" placeholder="Confirm password" name="confirmPassword" required minlength="8" maxlength="16"
      [(ngModel)]="user.confirmPassword" ngModel #confirmPassword="ngModel">
    <app-check-icon *ngIf="confirmPassword.valid && (user.password==user.confirmPassword)"></app-check-icon>
    <p></p>

    <label for="roles">roles</label>
    &nbsp;
    <select name="roles" ngModel required #roles="ngModel">
      <option value="-1"></option>
      <option value="0">Admin</option>
      <option value="1">Manager</option>
      <option value="2">General</option>
    </select>
    <app-check-icon *ngIf="roles.valid"></app-check-icon>
    <p></p>
    <hr>
    <h6>address details</h6>

    <input type="text" placeholder="country" name="county" required maxlength="30" [(ngModel)]="address.country" ngModel
      #country="ngModel">
    <app-check-icon *ngIf="country.valid"></app-check-icon>
    <p></p>
    <input type="text" placeholder="city" name="city" required maxlength="30" [(ngModel)]="address.city" ngModel
      #city="ngModel">
    <app-check-icon *ngIf="city.valid"></app-check-icon>
    <p></p>
    <input type="text" placeholder="street" name="street" required maxlength="30" [(ngModel)]="address.street" ngModel
      #street="ngModel">
    <app-check-icon *ngIf="street.valid"></app-check-icon>
    <p></p>
    <input type="number" placeholder="house number" name="houseNumber" required pattern="[0-9]{2}"
      [(ngModel)]="address.houseNumber" ngModel #houseNumber="ngModel">
    <app-check-icon *ngIf="houseNumber.valid"></app-check-icon>
    <p></p>
    <input type="number" placeholder="postal code" name="postalCode" required pattern="[1-9]{7}"
      [(ngModel)]="address.postalCode" ngModel #postalCode="ngModel">
    <app-check-icon *ngIf="postalCode.valid"></app-check-icon>
    <p></p>

    <app-image-upload (onUploadFinished)="uploadFinished($event)"></app-image-upload>
    <p></p>
    <button class="btn btn-primary" (click)="openModal(template)">Add</button>
  </form>


</div>

<p></p>

<div [hidden]="showEmployees" class="p-3">

  <input type="text" class="form-control" placeholder="search for employee by id" [ngModel]="search"
    (ngModelChange)="onEmployeeSearch($event)">

  <p></p>

  <div class="table-responsive">
    <table class="table align-middle table-info table-bordered">
      <thead>
        <tr>
          <th scope="col">Id</th>
          <th scope="col">First Name</th>
          <th scope="col">Last Name</th>
          <th scope="col">Age</th>
          <th scope="col">Email</th>
          <th scope="col">Phone</th>
          <th scope="col">Birth Date</th>
          <th scope="col">started Date</th>
          <th scope="col">Bank Account</th>
          <th scope="col">Salary Per Hour</th>
          <th scope="col">Seniority</th>
          <th scope="col">Is Active</th>
          <th scope="col">Job Type</th>
          <th scope="col">Address</th>
          <th scope="col">Image</th>
          <th scope="col"></th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let employee of filteredEmployees">
          <td>{{employee.id}}</td>
          <td>{{employee.firstName}}</td>
          <td>{{employee.lastName}}</td>
          <td>{{employee.age}}</td>
          <td>{{employee.email}}</td>
          <td>{{employee.phoneNumber}}</td>
          <td>{{employee.birthDay}}/{{employee.birthMonth}}/{{employee.birthYear}}</td>
          <td>{{employee.startedDay}}/{{employee.startedMonth}}/{{employee.startedYear}}</td>
          <td>{{employee.bankAccount.accountNumber}}</td>
          <td>{{employee.salaryPerHour}}</td>
          <td>{{employee.seniority}}</td>
          <td>{{employee.isActivated}}</td>
          <td>{{getEmployeeType(employee.jobType)}}</td>
          <td>{{employee.address.country}},{{employee.address.city}},{{employee.address.street}}</td>
          <td><img src={{getImage(employee.user.imagePath)}} alt="employee image" class="img-thumbnail"></td>
          <td><button title="delete" class="btn btn-danger" (click)="openModal(template)"
              (click)="deleteEmployee(employee)">
              <app-trash-icon></app-trash-icon>
            </button></td>
          <td><button class="btn btn-primary" title="update" (click)="openModal2(template2)"
              (click)="onUpdateClick(employee)">🖊️</button></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<ng-template #template>
  <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="modalRef?.hide()">
    <span aria-hidden="true" class="visually-hidden">&times;</span>
  </button>
  <div class="modal-body text-info text-center">
    <h5>{{message}}</h5>
  </div>
</ng-template>

<ng-template #template2>
  <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="modalRef2?.hide()">
    <span aria-hidden="true" class="visually-hidden">&times;</span>
  </button>

  <h5 *ngIf="isSubmit" class="text-dark text-center fw-bold">Employee Updated Successfully</h5>

  <div *ngIf="!isSubmit" class="modal-body text-info text-center">
    <h5 class="text-dark fw-bold p-2">Updated Employee</h5>

    <alert [hidden]="hideUpdateMessage" type="danger" class="m-4">
      <strong class="text-danger fw-bolder">check your inputs</strong>
    </alert>

    <form #employee="ngForm" (ngSubmit)="onUpdateSubmit(employee)">

      <label for="id">id</label>
      <p><input type="number" name="id" [(ngModel)]="updatedEmployee.id" readonly></p>

      <label for="firstName">first Name</label>
      <p><input type="text" name="firstName" [(ngModel)]="updatedEmployee.firstName" readonly></p>

      <label for="lastName">last Name</label>
      <p><input type="text" name="lastName" [(ngModel)]="updatedEmployee.lastName" readonly></p>

      <label for="age">age</label>
      <p><input type="number" name="age" [(ngModel)]="updatedEmployee.age" readonly></p>

      <label for="email">email</label>
      <p><input type="email" name="email" [(ngModel)]="updatedEmployee.email" maxlength="30" required></p>

      <label for="phone">phone</label>
      <p><input type="tel" name="phoneNumber" [(ngModel)]="updatedEmployee.phoneNumber" pattern="[0-9]{10}" required>
      </p>

      <label for="birthday">birth date</label>
      <p class="text-primary">{{updatedEmployee.birthDay}}/{{updatedEmployee.birthMonth}}/{{updatedEmployee.birthYear}}
      </p>

      <label for="accountnumber">salary per hour</label>
      <p><input type="number" name="salaryPerHour" [(ngModel)]="updatedEmployee.salaryPerHour" pattern="[0-9]{2}"
          required></p>

      <label for="jobType">job type</label>
      &nbsp;
      <select name="jobType" [(ngModel)]="updatedEmployee.jobType" required>
        <option value="-1"></option>
        <option value="0">Director</option>
        <option value="1">Manager</option>
        <option value="2">General</option>
      </select>

      <p></p>

      <label for="isActivated">is activated</label>
      &nbsp;
      <select name="isActivated" [(ngModel)]="updatedEmployee.isActivated" required>
        <option value="-1"></option>
        <option value="true">true</option>
        <option value="false">false</option>
      </select>

      <hr>

      <h6 class="text-dark p-2">bank account details</h6>

      <label for="accountnumber">account number</label>
      <p><input type="number" name="accountNumber" [(ngModel)]="updatedBankAccount.accountNumber"
          pattern="[0-9]{6}" required></p>

      <label for="ownerid">owner id</label>
      <p> <input type="number" name="ownerId" [(ngModel)]="updatedBankAccount.ownerId" pattern="[0-9]{9}"
          required></p>

      <label for="accountFirstName">first Name</label>
      <p> <input type="text" name="ownerFirstName" [(ngModel)]="updatedBankAccount.firstName" maxlength="30"
          required></p>

      <label for="accountLastName">last Name</label>
      <p> <input type="text" name="ownerLastName" [(ngModel)]="updatedBankAccount.lastName" maxlength="30"
          required></p>

      <label for="bankName">bank company</label>
      &nbsp;
      <select name="bankName" [(ngModel)]="updatedBankAccount.name" required>
        <option value="-1"></option>
        <option value="0">Leumi</option>
        <option value="1">Boalim</option>
        <option value="2">Discont</option>
        <option value="3">Masad</option>
        <option value="4">Mezrahi</option>
        <option value="5">Yahav</option>
      </select>

      <p></p>

      <label for="accountnumber">branch number</label>
      <p> <input type="number" name="branchNumber" [(ngModel)]="updatedBankAccount.branchNumber"
          pattern="[0-9]{1,3}" required></p>

      <hr>

      <h6 class="text-dark p-2">user details</h6>

      <label for="userFirstName">first name</label>
      <p> <input type="text" name="userFirstName" [(ngModel)]="updatedUser.firstName" readonly></p>

      <label for="userLastName">last name</label>
      <p> <input type="text" name="userLastName" [(ngModel)]="updatedUser.lastName" readonly></p>

      <label for="userEmail">email</label>
      <p> <input type="email" name="userEmail" [(ngModel)]="updatedUser.email" maxlength="30" required></p>

      <label for="password">password</label>
      <p> <input type="password" name="password" [(ngModel)]="updatedUser.password" minlength="8"
          maxlength="16"></p>

      <label for="roles">roles</label>
      &nbsp;
      <select name="role" [(ngModel)]="updatedUser.role" required>
        <option value=-1></option>
        <option value=0>admin</option>
        <option value=1>manager</option>
        <option value=2>general</option>
      </select>

      <p></p>

      <app-image-upload (onUploadFinished)="uploadFinished($event)"></app-image-upload>

      <hr>

      <h6 class="text-dark p-2">address details</h6>

      <label for="country">country</label>
      <p> <input type="text" name="country" [(ngModel)]="updatedAddress.country" maxlength="30" required></p>

      <label for="city">city</label>
      <p> <input type="text" name="city" [(ngModel)]="updatedAddress.city" maxlength="30" required></p>

      <label for="street">street</label>
      <p> <input type="text" name="street" [(ngModel)]="updatedAddress.street" maxlength="30" required></p>

      <label for="houseNumber">house number</label>
      <p> <input type="number" name="houseNumber" [(ngModel)]="updatedAddress.houseNumber"
          pattern="[0-9]{1,3}"></p>

      <label for="postalCode">postal code</label>
      <p> <input type="number" name="postalCode" [(ngModel)]="updatedAddress.postalCode" pattern="[0-9]{7}"
          required></p>


      <button class="btn btn-success">update</button>
    </form>
  </div>
</ng-template>